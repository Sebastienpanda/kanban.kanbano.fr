<div class="flex h-dvh bg-base-100">
  <app-sidebar
    (sidebarToggled)="onSidebarToggled()"
    (workplaceSelected)="onWorkplaceSelected($event)"
    [activeWorkplaceId]="activeWorkplaceId()"
    [collapsed]="sidebarCollapsed()"
    [workplaces]="workplaces()"
  />

  <div class="flex-1 flex flex-col">
    <header
      class="bg-base-300 border-b border-base-content/10 px-4 lg:px-6 py-3 lg:py-4 flex items-center justify-between shadow-lg backdrop-blur-xl">
      <div class="flex items-center gap-2 lg:gap-4 flex-1 min-w-0">
        <button (click)="onSidebarToggled()" class="btn btn-ghost btn-sm btn-circle md:hidden">
          <lucide-icon [img]="MenuIcon" [size]="20"></lucide-icon>
        </button>

        <h1
          class="text-lg lg:text-2xl truncate">
          {{ activeWorkplace()?.name }}
        </h1>
        <div class="badge badge-primary badge-sm lg:badge-lg gap-1 lg:gap-2 shadow-lg hidden sm:flex">
          <span class="hidden lg:inline">{{ activeColumns().length }} colonnes</span>
          <span class="lg:hidden">{{ activeColumns().length }}</span>
        </div>
      </div>

      <div class="flex items-center gap-2 lg:gap-3">
        <button (click)="openNewTaskModal()"
                class="btn btn-primary btn-sm gap-2 shadow-lg hover:scale-105 transition-transform hidden sm:flex">
          <lucide-icon [img]="PlusIcon" [size]="16"></lucide-icon>
          <span class="hidden lg:inline">Nouvelle t√¢che</span>
        </button>
        <button (click)="openNewTaskModal()" class="btn btn-primary btn-sm btn-circle sm:hidden">
          <lucide-icon [img]="PlusIcon" [size]="16"></lucide-icon>
        </button>
        <button (click)="toggleTheme()" class="btn btn-ghost btn-sm btn-circle">
          @if (isDarkMode()) {
            <lucide-icon [img]="SunIcon" [size]="18"></lucide-icon>
          } @else {
            <lucide-icon [img]="MoonIcon" [size]="18"></lucide-icon>
          }
        </button>
      </div>
    </header>

    <main class="flex-1 overflow-hidden">
      @if (activeWorkplace()) {
        <app-kanban
          [columns]="activeColumns()"
          [onColumnsChange]="onColumnsChange.bind(this)"
          [onCreateTask]="openNewTaskModalForColumn.bind(this)"
          [onDeleteTask]="confirmDeleteTask.bind(this)"
          [onEditTask]="openEditTaskModal.bind(this)"
        />
      }
    </main>
  </div>

  <!-- New Task Modal (Clean Architecture Component) -->
  <app-new-task-modal
    [isOpen]="showNewTaskModal()"
    [columns]="modalColumns()"
    [selectedColumnId]="selectedColumnId()"
    (taskCreated)="onTaskCreated($event)"
    (closed)="closeNewTaskModal()"
  />

  <!-- Edit Task Modal (Clean Architecture Component) -->
  <app-edit-task-modal
    [isOpen]="showEditTaskModal()"
    [task]="editingTask()"
    (taskUpdated)="onTaskUpdated($event)"
    (closed)="closeEditTaskModal()"
  />

  <!-- Delete Confirm Modal (Clean Architecture Component) -->
  <app-delete-confirm-modal
    [isOpen]="showDeleteConfirm()"
    (confirmed)="onDeleteConfirmed()"
    (cancelled)="closeDeleteConfirm()"
  />
</div>
<ngx-sonner-toaster closeButton position="top-right" richColors/>

